name: Deploy Flutter Frontend (Fixed Path)

on:
  push:
    branches: [ "master", "main" ]
    paths:
      - 'Frontend/unishare_web/**' # Only run if the actual app folder changes

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      # 1. Setup Flutter
      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          channel: 'stable'
      
      # 2. Build Flutter (Correct Path)
      - name: Build Flutter Web
        working-directory: ./Frontend/unishare_web  # <--- UPDATED PATH
        run: |
          flutter pub get
          flutter build web --release

      # 3. Setup Node for the 'serve' command
      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '20'

      # 4. Install 'serve' (Correct Path)
      - name: Install Node Dependencies
        working-directory: ./Frontend/unishare_web  # <--- UPDATED PATH
        run: npm install

      # 5. Deploy to Azure
      - name: 'Deploy to Azure Web App'
        uses: azure/webapps-deploy@v3
        with:
          app-name: 'uni-share-frontend'
          slot-name: 'Production'
          # We deploy the specific app folder because it contains package.json AND build/web
          package: './Frontend/unishare_web'       
          publish-profile: ${{ secrets.AZUREAPPSERVICE_PUBLISHPROFILE_B22AAE6D0D514046BEC80F94EEFD54CE }}
